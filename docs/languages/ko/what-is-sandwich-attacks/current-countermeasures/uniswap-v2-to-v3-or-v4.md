---
sidebar_position: 5
---

# Uniswap: v2 → v3 (또는 v4)

Uniswap은 대표적 AMM 프로토콜로 DeFi의 기반을 닦았습니다. 그러나 설계상 샌드위치 공격에 취약하며, v3·v4는 이를 완화하기 위한 개선을 추가했습니다.

## v2: 단순한 정수 곱 모델
### 특징
- 정수 곱 AMM: `x * y = k`  
- 모든 LP가 동일 조건으로 풀에 참여  
- 가격은 스왑에 따른 잔고 변동으로 결정  

### 한계
- 트랜잭션이 공개 메모풀에 나타나 전제적으로, 프런트런→피해자→백런 패턴이 용이.  
- 슬리피지 보호가 있어도 유도된 가격 변동으로 불리한 체결이 가능.  

---

## v3: 집중 유동성과 커스텀 범위
### 개선점
- 집중 유동성: LP가 가격 구간을 지정, 자본 효율 향상.  
- 여러 풀: 다양한 수수료·가격대가 병렬 존재.  

### 샌드위치 관점의 변화
- 특정 범위에 유동성이 몰리면, 작은 가격 변화에도 슬리피지가 커질 수 있음.  
- 여전히 ‘피해자 거래 관측 후 선행’ 전략이 유효.  
- v2보다 복잡해졌지만, 근본 해결은 아님.  

---

## v4: Hooks와 커스터마이징
### Hooks
- 스왑 전후에 커스텀 로직을 삽입할 수 있는 확장 포인트.  
- 예:
  - 온체인 오더북 유사 동작
  - 동적 수수료
  - 추가 검증 로직  

### 샌드위치 완화 적용
- 트랜잭션 순서/조건 검증 로직으로 공격 면적을 줄임.  
- 예: 지정 슬리피지 초과 주문 거부, 프라이빗 전송과 조합.  
- 단, 훅은 선택 사항이며 기본적으로 샌드위치를 차단하지는 않음.  

---

## 마이그레이션 과제
- 많은 사용자·프로토콜이 여전히 v2 풀에 의존.  
- 이유:
  - v3+ 유동성 운영이 더 복잡·비용 증가.  
  - 다운스트림 프로토콜/애그리게이터가 v2에 묶여 전환이 느림.  
  - v4는 초기 단계로 채택까지 시간 필요.  
- 결과적으로 취약한 v2 풀에 많은 자본이 머뭄.  

---

## 요약
- v2: 가장 단순하지만 샌드위치에 가장 취약.  
- v3: 자본 효율 개선, 그러나 공격 면적은 잔존.  
- v4: 훅으로 더 견고한 DEX 설계 가능하나 기본 차단은 아님.  

Uniswap의 진화는 샌드위치를 완전히 막기보다, 설계자·사용자가 대응을 조합할 수 있는 유연성을 제공합니다.
